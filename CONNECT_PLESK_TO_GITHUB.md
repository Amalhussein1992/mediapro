# ๐ ุฑุจุท Plesk ุจู GitHub Repository ุงูููุฌูุฏ

## ุงููุนูููุงุช ุงูุญุงููุฉ โ

- **Repository:** `git@github.com:Amalhussein1992/mediapro.git`
- **HTTPS URL:** `https://github.com/Amalhussein1992/mediapro.git`
- **Owner:** Amalhussein1992
- **Repo Name:** mediapro

---

## ุงูุฎุทูุงุช ุงููุงููุฉ

### 1๏ธโฃ ุฅุนุฏุงุฏ Git ูู Plesk

#### ูู Plesk Panel:

1. **ุงุฐูุจ ุฅูู:**
   ```
   Websites & Domains โ mediapro.social โ Git
   ```

2. **ุฅุฐุง ูุงู Repository ูุฑุจูุท ุจุงููุนู:**
   - ุงุถุบุท **Manage domain** (ุดุงููู ูู ุงูุตูุฑุฉ ุงููู ุฃุฑุณูุชูุง)
   - ุชุญูู ูู ุงูุฅุนุฏุงุฏุงุช

3. **ุฅุฐุง ูู ููู ูุฑุจูุท:**
   - ุงุถุบุท **Add Repository** ุฃู **Pull Updates**

---

### 2๏ธโฃ ุฅุนุฏุงุฏ Git Repository ูู Plesk

#### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู HTTPS (ุงูุฃุณูู)

ูู ุตูุญุฉ Git Settings:

```
Repository URL: https://github.com/Amalhussein1992/mediapro.git
Repository Path: /httpdocs
Branch: main
```

**Authentication:**
- Username: `Amalhussein1992`
- Password/Token: **Personal Access Token** ูู GitHub

**ููู ุชุญุตู ุนูู Personal Access Token:**

1. ุงุฐูุจ ุฅูู GitHub: https://github.com/settings/tokens
2. **Developer settings** โ **Personal access tokens** โ **Tokens (classic)**
3. **Generate new token** โ **Generate new token (classic)**
4. ุงุณู ุงูุชููู: `Plesk mediapro.social`
5. ูุนูู ุงูุตูุงุญูุงุช:
   - โ `repo` (ูู ุงูุตูุงุญูุงุช)
   - โ `admin:repo_hook`
6. **Generate token**
7. **ุงูุณุฎ ุงูุชููู** (ูุธูุฑ ูุฑุฉ ูุงุญุฏุฉ ููุท!)
8. ุงุณุชุฎุฏูู ูู Password ูู Plesk

---

#### ุงูุทุฑููุฉ 2: ุงุณุชุฎุฏุงู SSH Key (ุฃูุถู ููุฃูุงู)

**ุงูุฎุทูุฉ 1: ุชูููุฏ SSH Key ูู Plesk**

ุนุจุฑ SSH Terminal ูู Plesk:

```bash
# Login to server
cd ~/.ssh

# Generate SSH key
ssh-keygen -t ed25519 -C "plesk-mediapro@mediapro.social"

# Press Enter for default location
# Press Enter twice for no passphrase

# Copy the public key
cat ~/.ssh/id_ed25519.pub
```

**ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ SSH Key ูู GitHub**

1. ุงูุณุฎ ูุญุชูู `id_ed25519.pub`
2. ุงุฐูุจ ุฅูู GitHub: https://github.com/Amalhussein1992/mediapro/settings/keys
3. **Deploy keys** โ **Add deploy key**
4. Title: `Plesk mediapro.social`
5. Key: ุงูุตู ุงูููุชุงุญ ุงูุนุงู
6. โ **Allow write access** (ุฅุฐุง ููุช ุชุฑูุฏ Push ูู ุงูุณูุฑูุฑ)
7. **Add key**

**ุงูุฎุทูุฉ 3: ุงุณุชุฎุฏุงู SSH URL ูู Plesk**

```
Repository URL: git@github.com:Amalhussein1992/mediapro.git
Repository Path: /httpdocs
Branch: main
```

---

### 3๏ธโฃ ุชุญุฏูุซ Deployment Settings

ุชุฃูุฏ ูู:

**Deployment mode:**
- โ **Automatic**

**Deployment steps:**
```
โฌ 1. Enable maintenance mode
โ 2. Fetch source code
โ 3. Deploy source code from Git
โ 4. Install composer.json dependencies
โฌ 5. Install package.json dependencies  (ุบูุฑ ูุทููุจ ููุจุงู ุงูุฏ)
โ 6. Run deployment script
โฌ 7. Disable maintenance mode
```

**Deployment script:** (ุงุถุบุท Edit script)

```bash
#!/bin/bash
set -e

echo "========================================="
echo "MediaPro - Deployment Started"
echo "========================================="

cd /var/www/vhosts/mediapro.social/httpdocs

# Install dependencies
echo "[1/8] Installing Composer dependencies..."
composer install --no-dev --no-interaction --prefer-dist --optimize-autoloader

# Setup .env
echo "[2/8] Environment setup..."
if [ ! -f ".env" ]; then
    if [ -f ".env.server" ]; then
        cp .env.server .env
        echo "โ Created .env"
    fi
fi

# Clear caches
echo "[3/8] Clearing caches..."
php artisan config:clear
php artisan cache:clear
php artisan route:clear
php artisan view:clear

# Migrations
echo "[4/8] Running migrations..."
php artisan migrate --force

# Build caches
echo "[5/8] Building caches..."
php artisan config:cache
php artisan route:cache
php artisan view:cache

# Storage link
echo "[6/8] Storage link..."
php artisan storage:link || true

# Permissions
echo "[7/8] Fixing permissions..."
chmod -R 775 storage bootstrap/cache
chown -R $USER:psacln storage bootstrap/cache || true

# Verify
echo "[8/8] Verification..."
php artisan --version

echo "========================================="
echo "โ Deployment Complete!"
echo "Time: $(date)"
echo "========================================="
```

---

### 4๏ธโฃ ุฅุนุฏุงุฏ GitHub Webhook

#### ูู GitHub Repository:

1. ุงุฐูุจ ุฅูู: https://github.com/Amalhussein1992/mediapro/settings/hooks

2. **Add webhook**

3. **Payload URL:**
   ```
   https://65-159-66-148.host.secureserver.net:8443/modules/git/public/web-hook.php?uuid=16a7feec-5a60-224d-2881-8bb9e4e5607d
   ```

4. **Content type:**
   ```
   application/json
   ```

5. **Which events would you like to trigger this webhook?**
   - โช Just the push event (ุงุฎุชุฑ ูุฐุง)

6. **Active:**
   - โ ุชุฃูุฏ ุฃูู ููุนูู

7. **Add webhook**

---

### 5๏ธโฃ ุงุฎุชุจุงุฑ Auto Deployment

#### ุนูู ุฌูุงุฒู:

```bash
cd c:\Users\HP\Desktop\social-media-app\SocialMediaManager\backend-laravel

# ุนุฏูู ููู ุจุณูุท (ุงุฎุชุจุงุฑ)
echo "// Auto deployment test" >> routes/api.php

# Commit
git add .
git commit -m "Test: Auto deployment from Plesk"

# Push
git push origin main
```

#### ุฑุงูุจ Plesk:

1. ุงุฐูุจ ุฅูู: **Websites & Domains** โ **mediapro.social** โ **Git**
2. ุดูู **Deployment Status**
3. ูุฌุจ ุฃู ูุจุฏุฃ ุชููุงุฆูุงู ุฎูุงู 10-30 ุซุงููุฉ
4. ุงุถุบุท **Logs** ููุดุงูุฏุฉ ุงูุชูุงุตูู

---

### 6๏ธโฃ ุงูุชุญูู ูู ุงููุฌุงุญ

**ุงูุชุญ ูู ุงููุชุตูุญ:**

```
https://mediapro.social/test.php
https://mediapro.social/api/config
```

ูุฌุจ ุฃู ูุนุฑุถ ุงููุนูููุงุช ุจุดูู ุตุญูุญ.

---

## ๐ง ุญู ุงููุดุงูู

### ุงููุดููุฉ: Authentication failed

**ุงูุญู 1 - HTTPS:**
- ุชุฃูุฏ ูู Personal Access Token ุตุญูุญ
- ุชุฃูุฏ ูู ุงูุตูุงุญูุงุช: `repo` ู `admin:repo_hook`

**ุงูุญู 2 - SSH:**
- ุชุฃูุฏ ูู ุฅุถุงูุฉ SSH Key ูู GitHub Deploy keys
- ุชุฃูุฏ ูู ุชูุนูู "Allow write access"

---

### ุงููุดููุฉ: Webhook ูุง ูุนูู

**ุงูุญู:**

1. ูู GitHub โ Webhooks โ ุงุถุบุท ุนูู ุงูู Webhook
2. ุดูู **Recent Deliveries**
3. ุฅุฐุง ูู ุฃุฎุทุงุก:
   - ุชุฃูุฏ ูู ุงูุฑุงุจุท ุตุญูุญ
   - ุชุฃูุฏ ูู `uuid` ููุณ ุงููู ูู Plesk
4. ุงุถุบุท **Redeliver** ููุฅุนุงุฏุฉ

---

### ุงููุดููุฉ: Deployment ููุดู

**ุงูุญู:**

1. ูู Plesk Git โ **Logs**
2. ุงูุฑุฃ ุฑุณุงูุฉ ุงูุฎุทุฃ
3. ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ:
   - **Composer install failed:** ุชุญูู ูู `composer.json`
   - **Migration failed:** ุชุญูู ูู `.env` database settings
   - **Permission denied:** ุดุบูู ุนุจุฑ SSH:
     ```bash
     chmod -R 775 /var/www/vhosts/mediapro.social/httpdocs/storage
     chmod -R 775 /var/www/vhosts/mediapro.social/httpdocs/bootstrap/cache
     ```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### ูููุงุช .gitignore

ุชุฃูุฏ ูู ุนุฏู ุฑูุน ูุฐู ุงููููุงุช:

```
.env              โ ูุญุชูู ูุนูููุงุช ุญุณุงุณุฉ
vendor/           โ ููุซุจูุช ุนุจุฑ composer
node_modules/     โ ููุซุจูุช ุนุจุฑ npm
storage/logs/*.log
.phpunit.result.cache
```

ููู `.gitignore` ููุฌูุฏ ุจุงููุนู ููุญูู ูุฐู ุงููููุงุช.

---

### ูููู ุงููุดุฑูุน ุนูู ุงูุณูุฑูุฑ

```
/var/www/vhosts/mediapro.social/
โโโ httpdocs/              โ Git repository ููุง
โ   โโโ app/
โ   โโโ config/
โ   โโโ public/            โ Document Root ูุดูุฑ ููุง
โ   โโโ vendor/            โ ูููุดุฃ ุจูุงุณุทุฉ composer
โ   โโโ .env               โ ููุณุฎ ูู .env.server
โ   โโโ ...
โโโ logs/
```

---

## ๐ฏ ุณูุฑ ุงูุนูู ุงููููู

ุจุนุฏ ุงูุฅุนุฏุงุฏ ุงููุงูู:

```bash
# 1. ุนุฏูู ุงูููุฏ ุนูู ุฌูุงุฒู

# 2. Commit ู Push
git add .
git commit -m "ูุตู ุงูุชุนุฏูู"
git push origin main

# 3. ุงูุชุธุฑ 10-30 ุซุงููุฉ

# 4. โ ุงููููุน ูุชุญุฏุซ ุชููุงุฆูุงู!
```

---

## ๐ ุงููููุงุช ุงููุณุงุนุฏุฉ

- **plesk-deployment-script.sh** - ุงูุณูุฑูุจุช ุงููุงูู
- **GIT_AUTO_DEPLOYMENT_AR.md** - ุงูุฏููู ุงูุดุงูู
- **QUICK_GIT_SETUP_AR.txt** - ุงูุฅุนุฏุงุฏ ุงูุณุฑูุน

---

## โ Checklist

- [ ] Repository ูุฑุจูุท ูู Plesk
- [ ] Authentication ุชุนูู (HTTPS Token ุฃู SSH Key)
- [ ] Deployment mode = Automatic
- [ ] Deployment script ูุญุฏูุซ
- [ ] GitHub Webhook ูุถุงู
- [ ] ุงุฎุชุจุงุฑ deployment ูุฌุญ
- [ ] ุงููููุน ูุนูู: https://mediapro.social

---

**ุฌุงูุฒ ููุจุฏุกุ** ๐

ุงุจุฏุฃ ุจุงูุฎุทูุฉ 1: ุฅุนุฏุงุฏ Authentication (HTTPS Token ุฃู SSH Key)
